{% extends "base.html" %}

{% block content %}
<div class="page-header">
    <h1>Upload Campaign</h1>
    <p>Upload a video, image, or ZIP file to analyze Instagram metrics</p>
</div>

<div class="card upload-card">
    <form action="/upload" method="POST" enctype="multipart/form-data" class="upload-form">
        <div class="form-section">
            <h3>Campaign Information</h3>

            <div class="form-row">
                <div class="form-group">
                    <label for="campaign_date">Campaign Date *</label>
                    <input type="date" id="campaign_date" name="campaign_date" required>
                </div>

                <div class="form-group">
                    <label for="campaign_name">Campaign Name *</label>
                    <input type="text" id="campaign_name" name="campaign_name"
                           placeholder="e.g., Summer Sale 2024" required>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="product_name">Product Name *</label>
                    <input type="text" id="product_name" name="product_name"
                           placeholder="e.g., iPhone 15 Pro" required>
                </div>

                <div class="form-group">
                    <label for="company">Company *</label>
                    <input type="text" id="company" name="company"
                           placeholder="e.g., Apple Inc." required>
                </div>
            </div>
        </div>

        <div class="form-section">
            <h3>Upload File</h3>

            <div class="upload-zone" id="uploadZone">
                <div class="upload-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                        <polyline points="17 8 12 3 7 8"/>
                        <line x1="12" y1="3" x2="12" y2="15"/>
                    </svg>
                </div>
                <p class="upload-text">Drag & drop your file here or click to browse</p>
                <p class="upload-hint">Supported: MP4, AVI, MOV, MKV, ZIP, JPG, PNG</p>
                <input type="file" id="file" name="file" accept=".mp4,.avi,.mov,.mkv,.zip,.jpg,.jpeg,.png" required>
                <div class="selected-file" id="selectedFile"></div>
            </div>
        </div>

        <div class="form-actions">
            <button type="submit" class="btn btn-primary btn-large">
                <span class="btn-text">Start Processing</span>
                <span class="btn-loading" style="display: none;">Processing...</span>
            </button>
        </div>
    </form>
</div>
{% endblock %}

{% block scripts %}
<script>
    // File upload zone interaction
    const uploadZone = document.getElementById('uploadZone');
    const fileInput = document.getElementById('file');
    const selectedFile = document.getElementById('selectedFile');

    uploadZone.addEventListener('click', () => fileInput.click());

    uploadZone.addEventListener('dragover', (e) => {
        e.preventDefault();
        uploadZone.classList.add('dragover');
    });

    uploadZone.addEventListener('dragleave', () => {
        uploadZone.classList.remove('dragover');
    });

    uploadZone.addEventListener('drop', (e) => {
        e.preventDefault();
        uploadZone.classList.remove('dragover');
        if (e.dataTransfer.files.length) {
            fileInput.files = e.dataTransfer.files;
            updateSelectedFile();
        }
    });

    fileInput.addEventListener('change', updateSelectedFile);

    function updateSelectedFile() {
        if (fileInput.files.length) {
            const file = fileInput.files[0];
            const sizeMB = (file.size / (1024 * 1024)).toFixed(2);
            selectedFile.innerHTML = `<strong>${file.name}</strong> (${sizeMB} MB)`;
            selectedFile.style.display = 'block';
        }
    }

    // Form submission
    document.querySelector('.upload-form').addEventListener('submit', function() {
        const btn = this.querySelector('.btn-primary');
        btn.querySelector('.btn-text').style.display = 'none';
        btn.querySelector('.btn-loading').style.display = 'inline';
        btn.disabled = true;
    });

    // Set default date to today
    document.getElementById('campaign_date').valueAsDate = new Date();
</script>
{% endblock %}
